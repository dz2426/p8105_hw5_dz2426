p8105\_hw5\_dz2426
================
Duzhi Zhao
11/2/2019

# Problem 1

``` r
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species)) %>% 
  # Clean variable names
  janitor::clean_names()
```

``` r
# Create vector argument x 
x = vector("list", length = 5)

# Create a function "q1_f"
q1_f = function(x) {
  # If input is numeric, replace value with the mean of this column
  if (is.numeric(x)) {
    replace(x, is.na(x), mean(x, na.rm = TRUE))
  } 
  # If input is not numeric, replace value with "virginica"
  else if (!is.numeric(x)) {
    replace(x, is.na(x), "virginica")
  }
}

# Apply q1_f function to each column of dataset
x = map(iris_with_missing, q1_f)

# Updated iris dataset
iris_without_missing = tibble(
  sepal_length = round(x$sepal_length, digits = 1),
  sepal_width = round(x$sepal_width, digits = 1),
  petal_length = round(x$petal_length, digits = 1),
  petal_width = round(x$sepal_width, digits = 1),
  species = x$species
) %>% 
  # Show the first 22 rows which indicate the success of filling NA
  head(22)

knitr::kable(iris_without_missing, caption = "Table 1: First 22 rows of Iris dataset")
```

| sepal\_length | sepal\_width | petal\_length | petal\_width | species   |
| ------------: | -----------: | ------------: | -----------: | :-------- |
|           5.1 |          3.5 |           1.4 |          3.5 | setosa    |
|           4.9 |          3.0 |           1.4 |          3.0 | setosa    |
|           4.7 |          3.2 |           1.3 |          3.2 | setosa    |
|           4.6 |          3.1 |           1.5 |          3.1 | setosa    |
|           5.0 |          3.6 |           1.4 |          3.6 | setosa    |
|           5.4 |          3.9 |           1.7 |          3.9 | setosa    |
|           5.8 |          3.4 |           1.4 |          3.4 | setosa    |
|           5.0 |          3.4 |           1.5 |          3.4 | setosa    |
|           4.4 |          2.9 |           1.4 |          2.9 | setosa    |
|           4.9 |          3.1 |           3.8 |          3.1 | setosa    |
|           5.4 |          3.1 |           1.5 |          3.1 | setosa    |
|           4.8 |          3.4 |           1.6 |          3.4 | setosa    |
|           5.8 |          3.1 |           1.4 |          3.1 | setosa    |
|           4.3 |          3.0 |           3.8 |          3.0 | setosa    |
|           5.8 |          4.0 |           3.8 |          4.0 | setosa    |
|           5.7 |          4.4 |           1.5 |          4.4 | setosa    |
|           5.4 |          3.9 |           1.3 |          3.9 | setosa    |
|           5.1 |          3.5 |           1.4 |          3.5 | setosa    |
|           5.7 |          3.8 |           1.7 |          3.8 | setosa    |
|           5.1 |          3.8 |           1.5 |          3.8 | setosa    |
|           5.4 |          3.4 |           1.7 |          3.4 | setosa    |
|           5.1 |          3.7 |           1.5 |          3.7 | virginica |

Table 1: First 22 rows of Iris dataset

# Problem 2

``` r
# Create a dataframe first including all file names
q2_df = tibble(
  file_names = list.files(path = './data/')
) %>% 
  # Read in data using map function
  mutate(name = map(.x = str_c("./data/", file_names), 
                    ~read_csv(.x))) %>% 
  # Expand dataset completely
  unnest() %>% 
  # Separate variable "file_names" into two variables "group" and "subject id"
  separate(file_names, into = c("group", "subject_id"), sep = "_", remove = F) %>% 
  # Tidy weekly observation data in a pivot_longer format
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "observation") %>% 
  # Tidy data
  mutate(week = str_replace(week, "week_", ""),
         file_names = str_replace(file_names, ".csv", ""),
         subject_id = str_replace(subject_id, ".csv", ""),
         group = str_replace(group, "con", "control"),
         group = str_replace(group, "exp", "experimental")
  )
```

``` r
# Spaghetti plot
q2_df %>% 
  ggplot(aes(x = week, y = observation, group = subject_id, color = subject_id)) +
  geom_line() + 
  facet_grid(~group) +
  labs(x = "Week", 
       y = "Observation",
       title = "Observations on each subject over time",
       fill = "Subject ID"
    ) +
  theme(strip.text = element_text(size = 12, face = 'bold'))
```

<img src="p8105_hw5_dz2426_files/figure-gfm/unnamed-chunk-4-1.png" width="100%" />

**Comments:**  
The spaghetti plot shows larger values for subjects in experimental
group compared to those in control group. Furthermore, observations on
experimental subjects indicated a positive trend over time, while
subjects in control group did not show significant difference after 8
weeks.
